name: MR Tagged Notification

on:
    pull_request:
        types: [labeled]

jobs:
    notify-mr-tagged:
        # Only run when release labels are added
        if: |
            github.event.label.name == 'release:staging' ||
            github.event.label.name == 'release:development' ||
            github.event.label.name == 'release:testing' ||
            github.event.label.name == 'release:production'
        runs-on: ubuntu-latest
        environment: ${{ 
            github.event.label.name == 'release:staging' && 'staging' ||
            github.event.label.name == 'release:development' && 'development' ||
            github.event.label.name == 'release:testing' && 'testing' ||
            github.event.label.name == 'release:production' && 'production'
            }}
        steps:
            - name: Send MR info to API
              run: |
                  echo "=== Debug: Environment Variables ==="
                  echo "TTRAA_URL: $TTRAA_URL"
                  echo "TTRAA_URL length: ${#TTRAA_URL}"
                  if [ -z "$TTRAA_URL" ]; then
                      echo "⚠️  WARNING: TTRAA_URL is empty!"
                  else
                      echo "✅ TTRAA_URL is set: $TTRAA_URL"
                  fi
                  echo "===================================="
                  
                  PAYLOAD=$(jq -n --arg content "${{ github.event.pull_request.body }}" '{ content: $content }')

                  curl -X POST \
                    -H "Content-Type: application/json" \
                    -d "$PAYLOAD" \
                    "$TTRAA_URL/api/admin/app-release/on-mr-tagged"

