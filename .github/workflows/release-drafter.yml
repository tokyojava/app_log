# Release Drafter - Automatically collect PR info and generate Draft Release
#
# How it works:
#   1. When PR is merged to main -> Add PR to Draft Release
#   2. Multiple PRs accumulate, already released PRs won't be duplicated
#
# See: .github/RELEASE_GUIDE.md

name: Release Drafter

on:
  push:
    branches:
      - main
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

jobs:
  update_release_draft:
    if: (github.event_name == 'push' && github.ref == 'refs/heads/main') || github.event_name == 'workflow_dispatch'
    runs-on: ubuntu-latest
    steps:
      - name: Run Release Drafter
        id: release-drafter
        uses: release-drafter/release-drafter@v6
        with:
          config-name: release-drafter-config.yml
          commitish: main
          disable-autolabeler: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Log Release Info
        run: |
          echo "Draft Release updated"
          echo "  Version: ${{ steps.release-drafter.outputs.tag_name }}"
          echo "  Name: ${{ steps.release-drafter.outputs.name }}"
          echo "  URL: ${{ steps.release-drafter.outputs.html_url }}"
